<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Vue 3 尝鲜</title>
      <link href="/2020/05/24/vue3start/"/>
      <url>/2020/05/24/vue3start/</url>
      
        <content type="html"><![CDATA[<p>4 月 16 日，vue 3 正式进入 beta 阶段，终于忍不住尝鲜的心情，今天来尝试一下 Vue 3.0 的新特性。</p><h2 id="创建-Vue-3-项目"><a href="#创建-Vue-3-项目" class="headerlink" title="创建 Vue 3 项目"></a>创建 Vue 3 项目</h2><h4 id="安装-vue-cli"><a href="#安装-vue-cli" class="headerlink" title="安装 vue-cli"></a>安装 vue-cli</h4><pre class=" language-shell"><code class="language-shell">// 安装 vue-clicnpm install -g @vue/cli</code></pre><h4 id="vue-create-创建项目"><a href="#vue-create-创建项目" class="headerlink" title="vue create 创建项目"></a>vue create 创建项目</h4><pre><code>vue create vue3.0</code></pre><p>执行这步时，会有两个选项，我们选择第一个，先创建一个简单的 Vue 初始化项目。</p><p><img src="https://user-gold-cdn.xitu.io/2020/5/24/17245f7a7923fc5e?w=659&h=134&f=png&s=7851" alt></p><p>现在我们已经创建了一个 Vue 的初始化项目。我们可以查看根目录下的package.json 文件。</p>{% image https://user-gold-cdn.xitu.io/2020/5/24/17245f83c7ac2c49?w=631&h=544&f=png&s=44462 '' '' %}<p>可以看到，新建的项目还是 Vue 2.6 版本的。</p><p>还没升级之前的 2.x 版本</p>{% image https://user-gold-cdn.xitu.io/2020/5/24/17245f8b3f11e7fc?w=633&h=318&f=png&s=20601 '' '' %}{% image https://user-gold-cdn.xitu.io/2020/5/24/17245f940af533d1?w=646&h=757&f=png&s=57662 '' '' %}<h4 id="添加-vue-next-插件"><a href="#添加-vue-next-插件" class="headerlink" title="添加 vue-next 插件"></a>添加 vue-next 插件</h4><p>现在需要安装 vue-next 插件来把 Vue 升级2.6到 3.0beta 版本。</p><pre><code>// 安装完vue/cli以后，可以使用vue add添加插件// 目前3.0对应的是vue-next项目vue add vue-next</code></pre><p><img src="https://user-gold-cdn.xitu.io/2020/5/24/17245f9caef44537?w=1371&h=541&f=png&s=51963" alt></p><p>此时已经升级到 vue 3.0 了</p><p>左边目录结构并没有多大变化</p><p><img src="https://user-gold-cdn.xitu.io/2020/5/24/17245fa37422ff79?w=332&h=362&f=png&s=16912" alt></p><p>但是 main.js 的语法却和 Vue 2.x 的大不相同。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://user-gold-cdn.xitu.io/2020/5/24/17245fa99e497582?w=626&h=263&f=png&s=15854" alt title>                </div>                <div class="image-caption"></div>            </figure><h4 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h4><pre><code>npm run serve</code></pre><p>Vue 3.0 项目搭建完毕！如此简单！</p>{% image https://user-gold-cdn.xitu.io/2020/5/24/17245fb433c3a01f?w=1086&h=847&f=png&s=68517 '' '' %}<h2 id="开始一个小例子"><a href="#开始一个小例子" class="headerlink" title="开始一个小例子"></a>开始一个小例子</h2><p>在 Vue 2.x 中，我们一般在 <code>data</code> 里声明变量，methods 来声明方法。那么在 Vue 3 中呢？</p><p>在Vue3 的 可以使用 composition API 响应式来实现。</p><p>setup是新增的组件选项，相当于在组件内部使用Composition API的入口点。在 setup 方法中，我们可以创建使用新的 api 创建响应式的实例，返回属性和方法给模板渲染。</p><pre class=" language-vue"><code class="language-vue"><template>  <div id="app">    <div>{{ count }}</div>  </div></template><script>import { ref } from 'vue'export default {  name: 'App',  setup() {    const count = ref(0)    return {      count    }  }}</script><style>#app {  text-align: center;  color: #2c3e50;  margin-top: 60px;}</style></code></pre><p>其中，ref，可以初始化变量，返回的是一个 <strong>value reference （包装对象）</strong>。一个包装对象只有一个属性：<code>.value</code> ，该属性指向内部被包装的值。</p><p>我们知道，在 Vue 2.x 中，改变数组，必须触发数组的更新机制，使用变更方法，或者替换数组，但在 Vue 3 中，采用了 Proxy 代替了原来的 Object.defineproperty 的形式，所以，直接改变数组某一项，也会生效了。</p><p>我们来试一下改变数组的第一个元素</p><pre class=" language-vue"><code class="language-vue"><template>  <div id="app">    <div>count: {{ count }}</div>    <ul>      <li v-for="item in arr" :key="item">{{ item }}</li>    </ul>    <button @click="change">改变</button>  </div></template><script>import { ref } from 'vue'export default {  name: 'App',  setup() {    const count = ref(0)    const arr = ref(['1','2','3'])    const change = () => {      count.value++      arr.value[0] = count.value    }    return {      count, arr, change    }  }}</script><style>#app {  text-align: center;  color: #2c3e50;  margin-top: 60px;}</style></code></pre><p>展示效果：</p><p><img src="https://user-gold-cdn.xitu.io/2020/5/24/17245fbb3ac6151c?w=476&h=381&f=gif&s=36980" alt></p><h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>终于开始了Vue 3的探究之旅。Vue 3 和 Vue 2.x的不同， 主要体现在 <code>性能</code>、<code>Tree-shaking support</code> 、<code>Composition API</code> 、 <code>Fragment</code> 、<code>Teleport</code>、<code>Suspense</code> 、<code>TypeScript支持度</code> 和 <code>自定义 Render</code> 上。 更多的新特性还需日后多花时间了解……</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>vue 3 进入 beta 阶段</title>
      <link href="/2020/05/24/vue3beta/"/>
      <url>/2020/05/24/vue3beta/</url>
      
        <content type="html"><![CDATA[<p> 2020 年 4 月 16 日，vue 3.0 Beta 测试版发布了。</p><p><img src="https://user-gold-cdn.xitu.io/2020/4/19/17191fd6c468a2cc?w=600&h=135&f=png&s=27136" alt><br> 同日，尤大参加了 State of Vue 的线上活动，以下是他上传到 google docs 上的 slides ： <a href="https://docs.google.com/presentation/d/1LHp-8hEtXEMSE1fd6YLAhYmtndQelQKbWlGggZKe4y8/edit#slide=id.p" target="_blank" rel="noopener">State of Vue Apr 16 2020</a> </p><h2 id="vue-3-核心"><a href="#vue-3-核心" class="headerlink" title="vue 3 核心"></a>vue 3 核心</h2><h4 id="进入-Beta-阶段意味着什么？"><a href="#进入-Beta-阶段意味着什么？" class="headerlink" title="进入 Beta 阶段意味着什么？"></a>进入 Beta 阶段意味着什么？</h4><p><img src="https://user-gold-cdn.xitu.io/2020/4/19/17191f4a6b741116?w=1344&h=747&f=png&s=32315" alt></p><p> 目前，所有被列入计划的 RFCs 已经实现了，接下来 Vue 团队的重点是让 Vue 3 变得更加稳定，以及让 vue 相关的第三方库支持 vue 3。 </p><h4 id="vue-3-0-主要变化："><a href="#vue-3-0-主要变化：" class="headerlink" title="vue 3.0 主要变化："></a>vue 3.0 主要变化：</h4><p><img src="https://user-gold-cdn.xitu.io/2020/4/19/17191f4e0d96b264?w=1345&h=733&f=png&s=47809" alt></p><p> 主要体现在 <code>性能</code>、<code>Tree-shaking support</code> 、<code>Composition API</code> 、 <code>Fragment</code> 、<code>Teleport</code>、<code>Suspense</code> 、<code>TypeScript支持度</code> 和 <code>自定义 Render</code> 上。 </p><h4 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://user-gold-cdn.xitu.io/2020/4/19/17191f534342f912?w=1337&h=723&f=png&s=62475" alt title>                </div>                <div class="image-caption"></div>            </figure><p>重写了Vdom</p><p>编译优化</p><p>更加高效的组件初始化</p><p>性能提升1.2~2x</p><p>服务端渲速度提高2~3x</p><h4 id="Tree-shaking"><a href="#Tree-shaking" class="headerlink" title="Tree-shaking"></a>Tree-shaking</h4><p><img src="https://user-gold-cdn.xitu.io/2020/4/19/17191f5cc7000b7a?w=1332&h=721&f=png&s=63714" alt></p><p>​    vue 3 支持 Tree-shaking，从而大大得减少了 vue 的打包体积。 在 2.x 版本中，无论我们使用 Vue 核心中的哪些功能，所有未使用的功能最终都会进入我们的生产代码。而 vue 3  支持 tree-shaking，这意味着如果你不使用它的某些功能（例如<code>transition</code>组件或 v-model指令），则这些功能将不会包含在你的产品包中 。</p><h4 id="Composition-API"><a href="#Composition-API" class="headerlink" title="Composition API"></a>Composition API</h4><p><img src="https://user-gold-cdn.xitu.io/2020/4/19/17191f611c00e8dd?w=1325&h=722&f=png&s=42307" alt></p><p>​      Composition API 类似于 React Hooks。 Vue3.0 将抛弃之前的 Class API 的提案，选择了 Function API。目前，vue 官方 也提供了 Vue3.0 特性的尝鲜版本，前段时间叫 vue-function-api，目前已经改名叫  <a href="https://github.com/vuejs/composition-api" target="_blank" rel="noopener">composition-api</a> </p><h4 id="Fragments"><a href="#Fragments" class="headerlink" title="Fragments"></a>Fragments</h4><p><img src="https://user-gold-cdn.xitu.io/2020/4/19/17191f67626db67a?w=1338&h=726&f=png&s=34427" alt></p><p>​    template 模板中不再限制只有一个根节点，可以支持多个根节点 </p><p>​    render函数也可以返回数组</p><p>​    Fragments，即 片段， 类似于 React.Fragments，vue 2 中也有对应的库 <a href="https://github.com/y-nk/vue-fragment" target="_blank" rel="noopener">vue-fragments</a>  。Fragment 看起来像是普通的 DOM 元素，但它是虚拟的，根本不会在 DOM 树中渲染。这样我们就可以将组件功能绑定到单个元素中，而无需创建冗余的 DOM 节点。</p><h4 id="Teleport"><a href="#Teleport" class="headerlink" title="Teleport"></a>Teleport</h4><p><img src="https://user-gold-cdn.xitu.io/2020/4/19/17191f77e86da3eb?w=1330&h=716&f=png&s=29917" alt></p><p>​    Teleport 类似于 react 的 Portal。它可以使我们能够将一些HTML代码传送到组件外部应用程序中的另一个位置。例如，弹窗，通过 Teleport ，可以把弹窗直接挂在到 <code>body</code> 节点上，解决了弹窗被遮挡的问题 。</p><h4 id="Suspense"><a href="#Suspense" class="headerlink" title="Suspense"></a>Suspense</h4><p><img src="https://user-gold-cdn.xitu.io/2020/4/19/17191f7c57b94344?w=1332&h=728&f=png&s=41232" alt></p><p>​     Suspense 会延迟你的组件渲染，当某个条件触发时才会回调渲染该组件。相当于 slots 的组件。在 <code>Suspended-component</code> 完全渲染前，回调绑定将会一直展现。</p><pre class=" language-vue"><code class="language-vue"><Suspense>  <template >    <Suspended-component />  </template>  <template #fallback>    Loading...  </template></Suspense></code></pre><h4 id="Better-TypeScript-Support"><a href="#Better-TypeScript-Support" class="headerlink" title="Better TypeScript Support"></a>Better TypeScript Support</h4><p><img src="https://user-gold-cdn.xitu.io/2020/4/19/17191f83187aa273?w=1329&h=708&f=png&s=71435" alt></p><p>​        Vue官方从 2.6.X 版本开始就部分使用Ts重写了，对ts的支持会更加友好。</p><h4 id="Custom-Renderer-API"><a href="#Custom-Renderer-API" class="headerlink" title="Custom Renderer API"></a>Custom Renderer API</h4><p><img src="https://user-gold-cdn.xitu.io/2020/4/19/17191f86b455f653?w=1331&h=714&f=png&s=54928" alt></p><p>​     可以实现用 DOM一样使用Vue3 来进行 webgl 编程。<a href="https://vugel.planning.nl/#getting-started" target="_blank" rel="noopener">vue-fragments</a></p><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p><img src="https://user-gold-cdn.xitu.io/2020/4/19/17191f8959302604?w=1326&h=730&f=png&s=37563" alt></p><h4 id="文档和迁移进度"><a href="#文档和迁移进度" class="headerlink" title="文档和迁移进度"></a>文档和迁移进度</h4><p><img src="https://user-gold-cdn.xitu.io/2020/4/19/17191f8c3e312b61?w=1324&h=733&f=png&s=67530" alt></p><h4 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h4><p><img src="https://user-gold-cdn.xitu.io/2020/4/19/17191f8f0e65d273?w=1331&h=727&f=png&s=28767" alt></p><h4 id="vuex"><a href="#vuex" class="headerlink" title="vuex"></a>vuex</h4><p><img src="https://user-gold-cdn.xitu.io/2020/4/19/17191f93195ffcbf?w=1317&h=713&f=png&s=51219" alt></p><h4 id="vue-cli"><a href="#vue-cli" class="headerlink" title="vue-cli"></a>vue-cli</h4><p><img src="https://user-gold-cdn.xitu.io/2020/4/19/17191f95833d6410?w=1321&h=713&f=png&s=41723" alt></p><h4 id="vue-test-utils"><a href="#vue-test-utils" class="headerlink" title="vue-test-utils"></a>vue-test-utils</h4><p><img src="https://user-gold-cdn.xitu.io/2020/4/19/17191f9c22302455?w=1326&h=731&f=png&s=40345" alt></p><h4 id="DevTools"><a href="#DevTools" class="headerlink" title="DevTools"></a>DevTools</h4><p><img src="https://user-gold-cdn.xitu.io/2020/4/19/17191f9ef8aa02f8?w=1330&h=734&f=png&s=34907" alt></p><h4 id="IDE-Support-Vetur"><a href="#IDE-Support-Vetur" class="headerlink" title="IDE Support (Vetur)"></a>IDE Support (Vetur)</h4><p><img src="https://user-gold-cdn.xitu.io/2020/4/19/17191fa29a325653?w=1334&h=718&f=png&s=46868" alt></p><h4 id="Nuxt"><a href="#Nuxt" class="headerlink" title="Nuxt"></a>Nuxt</h4><p><img src="https://user-gold-cdn.xitu.io/2020/4/19/17191fa53233fb48?w=1337&h=731&f=png&s=35123" alt></p><h2 id="What-About-2-x"><a href="#What-About-2-x" class="headerlink" title="What About 2.x?"></a>What About 2.x?</h2><p><img src="https://user-gold-cdn.xitu.io/2020/4/19/17191fa72b81a799?w=1318&h=727&f=png&s=54620" alt></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>虽然 vue 3 已经进入 beta 阶段，但是还没有完全完善，一些vue相关的第三方库还没有完全支持。但是，vue 3 必然是一个趋势，随着 vue 3 越来越完善，在使用 vue 2.x 的项目中必然要面临着升级 vue 3 的问题。时时关注 vue 3 的新特性，对以后的开发有很大的帮助……</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Angular 基于列表类开发的列表组件</title>
      <link href="/2020/05/24/angularlist/"/>
      <url>/2020/05/24/angularlist/</url>
      
        <content type="html"><![CDATA[<h2 id="主要实现的功能"><a href="#主要实现的功能" class="headerlink" title="主要实现的功能"></a>主要实现的功能</h2><p>​    排序、分页、过滤、自定义操作列、列表中根据数据展示相应图标、跳转详情页</p><p><img src="https://user-gold-cdn.xitu.io/2020/5/1/171cf779b12d9fa9?w=1273&h=764&f=png&s=95431" alt></p><p>​    </p><h2 id="组件继承思想"><a href="#组件继承思想" class="headerlink" title="组件继承思想"></a>组件继承思想</h2><p>​    封装一个列表基类，派生类继承该类，复用基类的功能。</p><h5 id="Constructor-构造函数"><a href="#Constructor-构造函数" class="headerlink" title="Constructor 构造函数"></a>Constructor 构造函数</h5><p>​    如果派生类未声明构造函数，它将使用基类的构造函数。这意味着在基类构造函数注入的所有服务，子组件都能访问到。</p><h5 id="生命周期方法不继承"><a href="#生命周期方法不继承" class="headerlink" title="生命周期方法不继承"></a>生命周期方法不继承</h5><p>​    如果基类中包含生命周期钩子，如 <code>ngOnInit</code>、<code>ngOnChanges</code> 等，而在派生类没有定义相应的生命周期钩子，基类的生命周期钩子会被自动调用。如果需要在派生类触发<code>ngOnInit</code>，则需要在派生类上定义相应的生命周期钩子。</p><h5 id="继承的方法和属性基于可访问性级别"><a href="#继承的方法和属性基于可访问性级别" class="headerlink" title="继承的方法和属性基于可访问性级别"></a>继承的方法和属性基于可访问性级别</h5><p>​    派生类不能访问私有方法和属性，仅继承公共方法和属性。</p><h5 id="模板是不能被继承"><a href="#模板是不能被继承" class="headerlink" title="模板是不能被继承"></a>模板是不能被继承</h5><p>​    模板是不能被继承的 ，派生类需自定义模板，因此共享的 DOM 结构或行为需要单独处理。</p><h5 id="元数据和装饰器不继承"><a href="#元数据和装饰器不继承" class="headerlink" title="元数据和装饰器不继承"></a>元数据和装饰器不继承</h5><p>装饰器和元数据（<code>@Component</code>，<code>@Directive</code>，<code>@NgModule</code>等），这些元数据和装饰器不会被派生类继承，但是有一个例外，<code>@Input</code>和<code>@Output</code>装饰器会传递给派生类</p><h5 id="依赖注入"><a href="#依赖注入" class="headerlink" title="依赖注入"></a>依赖注入</h5><p>派生类必须通过调用super注入基类的参数</p><h2 id="实现过程"><a href="#实现过程" class="headerlink" title="实现过程"></a>实现过程</h2><p>application列表组件和基类<code>ResourceListBase</code>、<code>ResourceListWithStatuses</code> 关系</p><p><img src="https://user-gold-cdn.xitu.io/2020/5/1/171cf78143953f95?w=2333&h=1594&f=png&s=422427" alt></p><p>application列表组件主要继承父类<code>ResourceListWithStatuses</code>，通过重写<code>ResourceListWithStatuses</code>的方法，自定义模板，来复用父类的功能属性。</p><h4 id="组件定义"><a href="#组件定义" class="headerlink" title="组件定义"></a>组件定义</h4><h5 id="自定义模板"><a href="#自定义模板" class="headerlink" title="自定义模板"></a>自定义模板</h5><pre class=" language-ts"><code class="language-ts">@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  selector<span class="token punctuation">:</span> <span class="token string">'sym-application-list'</span><span class="token punctuation">,</span>  templateUrl<span class="token punctuation">:</span> <span class="token string">'./application.component.html'</span><span class="token punctuation">,</span>  changeDetection<span class="token punctuation">:</span> ChangeDetectionStrategy<span class="token punctuation">.</span>OnPush<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h5 id="继承父类"><a href="#继承父类" class="headerlink" title="继承父类"></a>继承父类</h5><p>通过expends继承父类</p><h5 id="重写父类方法"><a href="#重写父类方法" class="headerlink" title="重写父类方法"></a>重写父类方法</h5><p>通过继承基类<code>ResourceListWithStatuses</code>，可以复用其基本的功能属性，同时可以定义属性和方法扩展列表组件的功能，实现这个列表组件主要的是如果<strong>调用组件方法发起请求，获取到数据</strong></p><ul><li><p>重写<code>getResourceObservable</code> 方法，该方法主要是返回一个Observable，进行异步编程。</p><p>在这个方法里，可以请求多个api，使用Observable.forkJoin，可以合并多个Observable，返回一个Observable。</p></li><li><p>结合<code>sym-select</code> 组件搜索</p></li></ul><p><img src="https://user-gold-cdn.xitu.io/2020/5/1/171cf78d4b661e4c?w=1043&h=129&f=png&s=8970" alt></p><p>  <code>sym-select</code>组件的namespace下拉列表的数据nsList是异步获取的，如果是选择是的namespace是ALL，那么列表组件要获取到nsList，然后对每个nsList里的namespace进行全部请求。如果选择的是某个namesapce，那么就传入namespace的值，进行单个请求</p><p>  <strong>这里也是比较疑惑的地方</strong>，之前想通过<code>@Input</code>传入属性的方式，来把搜索组件的数据传递给applicaiton列表组件<code>sym-application-list</code></p><p>  <img src="https://user-gold-cdn.xitu.io/2020/5/1/171cf772f4bd76f9?w=335&h=396&f=png&s=20581" alt></p><p>  但是尝试之后，发现在页面初始化的时候，通过<code>@Input</code>的属性传入的<code>nsList</code>为空的。如果传入的属性是同步获取的，则可以传递到application列表组件中</p><p>  最后获取搜索参数的方式，采取<strong>服务依赖注入</strong>的方式来获取。</p><p>  <img src="https://user-gold-cdn.xitu.io/2020/5/1/171cf772eca2e820?w=846&h=332&f=png&s=39247" alt></p><ul><li>通过重写map 方法，在自定义表格的数据，返回所需表格的数据。</li></ul><pre class=" language-ts"><code class="language-ts"><span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>data_<span class="token punctuation">.</span>sortingDataAccessor <span class="token operator">=</span> <span class="token punctuation">(</span>item<span class="token punctuation">,</span> property<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token keyword">switch</span> <span class="token punctuation">(</span>property<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">case</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token keyword">return</span> item<span class="token punctuation">.</span>objectMeta<span class="token punctuation">.</span>name<span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'creationTimestamp'</span><span class="token punctuation">:</span> <span class="token keyword">return</span> item<span class="token punctuation">.</span>status<span class="token punctuation">.</span>creationTimestamp<span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'namespace'</span><span class="token punctuation">:</span> <span class="token keyword">return</span> item<span class="token punctuation">.</span>objectMeta<span class="token punctuation">.</span>namespace<span class="token punctuation">;</span>        <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token keyword">return</span> item<span class="token punctuation">[</span>property<span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">getResourceObservable</span><span class="token punctuation">(</span>params<span class="token operator">?</span><span class="token punctuation">:</span> HttpParams<span class="token punctuation">)</span><span class="token punctuation">:</span> Observable<span class="token operator">&lt;</span>ApplicationList<span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>localtionService_<span class="token punctuation">.</span>onNamespaceUpdate<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>namespace <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>localtionService_<span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>namespace<span class="token punctuation">;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>nsList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>localtionService_<span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>namespaceList<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> data<span class="token punctuation">:</span> <span class="token keyword">any</span> <span class="token operator">=</span> <span class="token punctuation">{</span>      items<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      listMeta<span class="token punctuation">:</span> <span class="token punctuation">{</span>        totalItems<span class="token punctuation">:</span> <span class="token number">0</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>namespace <span class="token operator">===</span> <span class="token string">'ALL'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nsList<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">const</span> observableList <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ns<span class="token punctuation">:</span> <span class="token keyword">any</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>application_<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>endpoint<span class="token punctuation">,</span> undefined<span class="token punctuation">,</span> ns<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>observableList <span class="token operator">&amp;&amp;</span> observableList<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Observable</span><span class="token punctuation">(</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>          observer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Observable</span><span class="token punctuation">(</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        Observable<span class="token punctuation">.</span><span class="token function">forkJoin</span><span class="token punctuation">(</span>observableList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">:</span> <span class="token keyword">any</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>          res<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> <span class="token keyword">any</span><span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token keyword">number</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            item<span class="token punctuation">.</span>items <span class="token operator">=</span> item<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">:</span> <span class="token keyword">any</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>              v<span class="token punctuation">.</span>objectMeta<span class="token punctuation">.</span>namespace <span class="token operator">=</span> list<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>              <span class="token keyword">return</span> v<span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            data<span class="token punctuation">.</span>items <span class="token operator">=</span> data<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>items<span class="token punctuation">)</span><span class="token punctuation">;</span>            data<span class="token punctuation">.</span>listMeta<span class="token punctuation">.</span>totalItems <span class="token operator">+</span><span class="token operator">=</span> item<span class="token punctuation">.</span>listMeta<span class="token punctuation">.</span>totalItems<span class="token punctuation">;</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          observer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>namespace <span class="token operator">!==</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>application_<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>endpoint<span class="token punctuation">,</span> undefined<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>namespace<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Observable</span><span class="token punctuation">(</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      observer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">map</span><span class="token punctuation">(</span>applicationList<span class="token punctuation">:</span> ApplicationList<span class="token punctuation">)</span><span class="token punctuation">:</span> Application<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>namespace <span class="token operator">!==</span> <span class="token string">'ALL'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      applicationList<span class="token punctuation">.</span>items <span class="token operator">=</span> applicationList<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">:</span> <span class="token keyword">any</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        v<span class="token punctuation">.</span>objectMeta<span class="token punctuation">.</span>namespace <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>namespace<span class="token punctuation">;</span>        <span class="token keyword">return</span> v<span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'applicationList'</span><span class="token punctuation">,</span> applicationList<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> applicationList<span class="token punctuation">.</span>items<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">isInErrorState</span><span class="token punctuation">(</span>resource<span class="token punctuation">:</span> Application<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">boolean</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> resource<span class="token punctuation">.</span>status <span class="token operator">?</span> <span class="token punctuation">(</span>resource<span class="token punctuation">.</span>status<span class="token punctuation">.</span>replicas <span class="token operator">&amp;&amp;</span> resource<span class="token punctuation">.</span>status<span class="token punctuation">.</span>replicas <span class="token operator">!==</span> resource<span class="token punctuation">.</span>status<span class="token punctuation">.</span>availableReplicas <span class="token operator">?</span>       <span class="token keyword">true</span> <span class="token punctuation">:</span> <span class="token keyword">false</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">false</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">isInSuccessState</span><span class="token punctuation">(</span>resource<span class="token punctuation">:</span> Application<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">boolean</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> resource<span class="token punctuation">.</span>status <span class="token operator">?</span> <span class="token punctuation">(</span>resource<span class="token punctuation">.</span>status<span class="token punctuation">.</span>replicas <span class="token operator">&amp;&amp;</span> resource<span class="token punctuation">.</span>status<span class="token punctuation">.</span>replicas <span class="token operator">===</span> resource<span class="token punctuation">.</span>status<span class="token punctuation">.</span>availableReplicas <span class="token operator">?</span>       <span class="token keyword">true</span> <span class="token punctuation">:</span> <span class="token keyword">false</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">false</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">protected</span> <span class="token function">getDisplayColumns</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'statusicon'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'namespace'</span><span class="token punctuation">,</span> <span class="token string">'labels'</span><span class="token punctuation">,</span> <span class="token string">'replicas'</span><span class="token punctuation">,</span> <span class="token string">'creationTimestamp'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span></code></pre><h4 id="组件使用"><a href="#组件使用" class="headerlink" title="组件使用"></a>组件使用</h4><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sym-application-list</span> <span class="token attr-name">#applicationList</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sym-application-list</span><span class="token punctuation">></span></span></code></pre><p>初始化时，调用getList请求方法</p><pre class=" language-ts"><code class="language-ts"><span class="token keyword">this</span><span class="token punctuation">.</span>applicationList<span class="token punctuation">.</span><span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="公共组件的巧妙之处"><a href="#公共组件的巧妙之处" class="headerlink" title="公共组件的巧妙之处"></a>公共组件的巧妙之处</h2><h5 id="actionColumn-操作列可以自定义"><a href="#actionColumn-操作列可以自定义" class="headerlink" title="actionColumn 操作列可以自定义"></a>actionColumn 操作列可以自定义</h5><p>在基类中已有声明注册操作列的方法，在application列表组件继承该方法，在构造函数中，注册操作列，<code>MenuComponent</code>是引入的组件</p><p><img src="https://user-gold-cdn.xitu.io/2020/5/1/171cf79c3d42251d?w=991&h=544&f=png&s=61021" alt></p><pre><code>this.registerActionColumn&lt;MenuComponent&gt;(&#39;menu&#39;, MenuComponent);</code></pre><h5 id="过滤功能"><a href="#过滤功能" class="headerlink" title="过滤功能"></a>过滤功能</h5><p><img src="https://user-gold-cdn.xitu.io/2020/5/1/171cf79fed6a6ab6?w=1029&h=276&f=png&s=28737" alt></p><p>这里的Pods列表组件也是继承了<code>ResourceListWithStatuses</code></p><p>继承的组件都会继承过滤功能，因为继承的组件的模板是自定义的，可以在模板上引入过滤的组件</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>kd-card-list-filter</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>kd-card-list-filter</span><span class="token punctuation">></span></span></code></pre><p>基类中以判断是否有过滤组件，并订阅过滤组件的方法触发列表过滤</p><pre class=" language-ts"><code class="language-ts"><span class="token function">ngAfterViewInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>data_<span class="token punctuation">.</span>sort <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>matSort_<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>data_<span class="token punctuation">.</span>paginator <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>matPaginator_<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cardFilter_<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// 表格搜索</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>cardFilter_<span class="token punctuation">.</span>filterEvent<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> filterValue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cardFilter_<span class="token punctuation">.</span>query<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>data_<span class="token punctuation">.</span>filter <span class="token operator">=</span> filterValue<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span></code></pre><h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>​    通过继承一些列表组件或者基类，可以大大地提升组件功能的复用率，并且能够提高开发效率。在一些业务场景中，我们总会面临着，多处一样的代码，如果有变动，就要全部更改，这样不利于代码的简洁，而且代码逻辑相对单一。由此我们要学会封装一些常用性的组件，来达到代码的复用率，加强代码的健壮性。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Angular 新建页面流程</title>
      <link href="/2020/05/24/angularcreatenew/"/>
      <url>/2020/05/24/angularcreatenew/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在一个月前，接手了一个angular框架的项目。接下来，不得不把angular的中文文档从头到尾啃一遍。在这过程中，我也把一些在开发中遇到的问题整理下来。</p><h2 id="目录概览"><a href="#目录概览" class="headerlink" title="目录概览"></a>目录概览</h2><pre><code>.src    // 项目源码目录    ├── app     // 应用的组件、模块    │   ├── app.component.spec.ts    │   ├── app.component.ts    // 根组件    │   ├── app.module.ts       // 根模块    │   ├── app-routing.module.ts   // 根路由    │   ├── chrome      // 菜单路由模块，左边菜单，头部导航栏    │   ├── common      // 公共目录，存放公共模块组件、全局services    │   ├── core.module.ts      // 全局核心模块    │   ├── custom.module.ts    // 自定义模块    │   ├── logs                // 日志模块    │   ├── monitor             // 监控模块    │   ├── overview    │   ├── region-and-cluster.d.ts            │   ├── region-and-cluster.json     // region和cluster的自定义数据    │   ├── region-and-cluster-test.json        │   ├── resource    // 主要页面模块    │   ├── shared.module.ts    │   └── typings     // 全局typescript类型声明    ├── assets          // 资源目录，存储静态资源的,比如图片    │   ├── baseui    │   └── images    ├── _dark.scss    ├── environments    // 环境配置，比如开发、测试、生产环境做不同配置    │   ├── environment.prod.ts    │   ├── environment.ts    │   └── version.ts    ├── favicon.ico     // 网站标志图标    ├── index.html      // 整个应用的根html，程序启动就是访问这个页面    ├── index.scss    ├── _light.scss    ├── main.ts         // 项目入口，通过这个文件来启动项目    ├── _mixins.scss    ├── polyfills.ts    // 主要是用来导入一些必要库, 兼容老版本    ├── styles.scss     // 全局的样式文件    ├── test.ts         // 自动化测试使用    ├── _theming.scss    ├── tree.txt    └── _variables.scss</code></pre><p>新建的页面主要流程，主要是在src/app/resource目录中创建对应模块，然后模块中创建对应的组件，如果组件中需创建公共组件，则在src/app/common中创建。</p><p>下面以新建<strong>网络配置信息概览subnet列表页</strong>为例，介绍新建页面的流程。</p><h2 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h2><h4 id="创建模块-network"><a href="#创建模块-network" class="headerlink" title="创建模块 network"></a>创建模块 <code>network</code></h4><p>切换到模块目录下，src/app/resource，执行</p><pre class=" language-shell"><code class="language-shell">ng g module network</code></pre><pre class=" language-shell"><code class="language-shell">ng g module network/subnet --routing</code></pre><h2 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h2><h3 id="组件subnet"><a href="#组件subnet" class="headerlink" title="组件subnet"></a>组件<code>subnet</code></h3><h4 id="创建组件subnet"><a href="#创建组件subnet" class="headerlink" title="创建组件subnet"></a>创建组件<code>subnet</code></h4><p>创建模块里的组件<code>subnet</code></p><pre class=" language-shell"><code class="language-shell">ng g component network/subnet/list</code></pre><h4 id="声明组件subnet"><a href="#声明组件subnet" class="headerlink" title="声明组件subnet"></a>声明组件<code>subnet</code></h4><p>src/app/resource/network/subnet/subnet.module.ts</p><pre class=" language-tsx"><code class="language-tsx">import { NgModule } from '@angular/core';import { CommonModule } from '@angular/common';import { SubnetRoutingModule } from './subnet-routing.module';import { SubnetComponent } from './list/list.component';import { SharedModule } from '../../../shared.module';import { ComponentsModule } from '../../../common/components/components.module';import { NavModule } from '../../../chrome/nav/nav.module';@NgModule({  declarations: [SubnetComponent],  imports: [    CommonModule,    SharedModule,    ComponentsModule,    SubnetRoutingModule,    NavModule,  ]})export class SubnetModule { }</code></pre><h4 id="添加到路由"><a href="#添加到路由" class="headerlink" title="添加到路由"></a>添加到路由</h4><p>src/app/chrome/chrome-routing.module.ts</p><pre class=" language-tsx"><code class="language-tsx">// Network group{    path: 'network',    loadChildren: '../resource/network/network.module#NetworkModule',},{    path: 'subnet',    loadChildren: '../resource/network/subnet/subnet.module#SubnetModule',},</code></pre><p>src/app/chrome/nav/nav.component.html</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>kd-nav-item</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>kd-nav-group-item<span class="token punctuation">"</span></span> <span class="token attr-name">state</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/network<span class="token punctuation">"</span></span> <span class="token attr-name">i18n</span><span class="token punctuation">></span></span>Network Config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>kd-nav-item</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>kd-nav-item</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>kd-nav-item<span class="token punctuation">"</span></span> <span class="token attr-name">state</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/subnet<span class="token punctuation">"</span></span> <span class="token attr-name">i18n</span><span class="token punctuation">></span></span>Subnet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>kd-nav-item</span><span class="token punctuation">></span></span></code></pre><h4 id="创建公共列表组件"><a href="#创建公共列表组件" class="headerlink" title="创建公共列表组件"></a>创建公共列表组件</h4><p>组件<code>subnet</code> 需创建其对应的列表组件</p><p>切换到公共列表组件目录下，src/app/common/components/resourcelists，执行</p><pre><code>ng g component subnet</code></pre><h3 id="公共列表组件组件"><a href="#公共列表组件组件" class="headerlink" title="公共列表组件组件"></a>公共列表组件组件</h3><h4 id="声明公共列表组件组件"><a href="#声明公共列表组件组件" class="headerlink" title="声明公共列表组件组件"></a>声明公共列表组件组件</h4><p>在/src/app/common/components/components.module.ts里</p><pre class=" language-tsx"><code class="language-tsx">import { SubnetListComponent } from './resourcelists/subnet/subnet.component';</code></pre><pre class=" language-tsx"><code class="language-tsx">@NgModule({  imports: [SharedModule],  declarations: [...components, ScaleEditDefaultActionbar, ActionbarDetailScaleComponent, NavComponent, ExecComponent, EndpontsComponent, SubnetListComponent],  exports: [...components],  entryComponents: [ChipDialog, RowDetailComponent, MenuComponent]})</code></pre><p>至此，network模块下的subnet组件已新建完成</p><pre><code>├── network│   ├── network.module.ts│   ├── network-routing.module.ts│   └── subnet│       ├── list│       │   ├── list.component.html│       │   ├── list.component.scss│       │   └── list.component.ts│       ├── subnet.module.ts│       └── subnet-routing.module.ts</code></pre><h4 id="列表页使用公共列表组件"><a href="#列表页使用公共列表组件" class="headerlink" title="列表页使用公共列表组件"></a>列表页使用公共列表组件</h4><p>在subnet组件中使用公共列表组件</p><p>src/app/resource/network/subnet/list/list.component.html</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sym-subnet-list</span> <span class="token attr-name">#subnetList</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sym-subnet-list</span><span class="token punctuation">></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>react 搜索组件</title>
      <link href="/2020/04/11/reactsearchcomponent/"/>
      <url>/2020/04/11/reactsearchcomponent/</url>
      
        <content type="html"><![CDATA[<figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/.com//search.png" alt title>                </div>                <div class="image-caption"></div>            </figure><h3 id="主要实现的功能"><a href="#主要实现的功能" class="headerlink" title="主要实现的功能"></a>主要实现的功能</h3><ol><li>​    能够实时搜索，能够手动搜索、清除</li><li>​    能根据不同类型显示各种表单类型，例如：日期、文本框、下拉列表</li><li>​    每个搜索选项，可以根据需要设置单选或多选操作</li></ol><h3 id="实现过程"><a href="#实现过程" class="headerlink" title="实现过程"></a>实现过程</h3><h4 id="构建组件结构"><a href="#构建组件结构" class="headerlink" title="构建组件结构"></a>构建组件结构</h4><p>​        基于ant design 的 Form表单进行开发，主要分为两部分，表单搜索选项和表单搜索、清除按钮，</p><p>​        表单搜索选项，是一些常见的表单选项，如果是一些不常见表单类型，采用自定义表单组件</p><p>​        实时搜索，主要调用了Form表单的 onValuesChange 方法</p><p>配置项：</p><table><thead><tr><th>属性</th><th>类型</th><th>描述</th><th>是否必填</th><th>默认值</th></tr></thead><tbody><tr><td>formInitialValue</td><td>Array</td><td>初始值</td><td>可选</td><td>无</td></tr><tr><td>filterConfig</td><td>Array</td><td>搜索项字段配置</td><td>必填</td><td>无</td></tr><tr><td>buttonLocation</td><td>String</td><td>按钮位置</td><td>可选</td><td>left</td></tr><tr><td>okButtonStyle</td><td>String</td><td>搜索按钮样式</td><td>可选</td><td>无</td></tr><tr><td>resetButtonStyle</td><td>String</td><td>清除按钮样式</td><td>可选</td><td>无</td></tr><tr><td>onSubmit</td><td>Function</td><td>搜索事件</td><td>可选</td><td>无</td></tr><tr><td>onReset</td><td>Function</td><td>清除事件</td><td>可选</td><td>无</td></tr></tbody></table><p>filterConfig</p><table><thead><tr><th>属性</th><th>类型</th><th>描述</th><th>是否必填</th><th>默认值</th></tr></thead><tbody><tr><td>label</td><td>String</td><td>字段 标签</td><td>是</td><td>无</td></tr><tr><td>name</td><td>String</td><td>字段 name</td><td>是</td><td>无</td></tr><tr><td>type</td><td>String</td><td>搜索类型（多选按钮或者单选按钮: Button（默认）、日期: Date、下拉选择: Select、文本框: Text）</td><td></td><td>Button</td></tr><tr><td>options</td><td>Array</td><td>type为 Button、Select 时</td><td>否</td><td>无</td></tr></tbody></table><h4 id="添加反向数据流"><a href="#添加反向数据流" class="headerlink" title="添加反向数据流"></a>添加反向数据流</h4><p>​        Form 会对直接子元素绑定表单功能，即不用去手动绑定，就能获取其数据，但是对于一些自定义表单组件，就要提供 onChange 事件或 trigger 的值同名的事件，在把自定义表单组件的数据传到父组件中去</p><h4 id="代码结构"><a href="#代码结构" class="headerlink" title="代码结构"></a>代码结构</h4><p>SearchFilter.tsx</p><pre class=" language-react"><code class="language-react">/** * 搜索组件 * <SearchFilter    filterConfig={this.filterConfig}    onSubmit={this.handleSearch}    onReset={this.handleReset}  />  表单配置项  filterConfig = [    {      label: '备件类型',      name: 'type',      type: 'Button',   // 表单类型 多选按钮或单选按钮：Button（默认）、 日期：Date、 下拉选择：Select、 文本框：Text      mode: 'multiple', // 默认多选    单选为 single      options: [        {          id: '',          label: ''        }      ]    },    {      label: '时间周期',      name: 'date_picker',      type: 'Date'    },  ]; */import React, { Component } from 'react';import { Button, Form, Row, Col, Select, Card, Input } from 'antd';import { FormComponentProps } from 'antd/lib/form/Form';import ChoiceDatePicker from '../ChoiceDatePicker';import ButtonSelect from '../ButtonSelect';import {  filterForm, filterFormItemWithNormal,} from './index.less';const { Option } = Select;export interface ItemProps {  id: string | number;  label: string | number;}export interface SearchFilterValue {  [propName: string]: string | number | any;}export interface FormItem {  label: string;  mode: string;  name: string;  type: string;  options: ItemProps[];}export interface SearchFilterProps extends FormComponentProps{  onSubmit?: (values: SearchFilterValue) => void;  onReset?: () => void;  formInitialValue?: {    [propName: string]: string | number;  };  disableFields?: string[];  filterConfig: FormItem[];  okButtonStyle?: {    [propName: string]: string | number;  };  resetButtonStyle?: {    [propName: string]: string | number;  };  buttonLocation?: 'left' | 'right';}export interface SearchFilterState {}class SearchFilter extends Component<SearchFilterProps, SearchFilterState> {  handleSearch = (e: React.FormEvent<HTMLFormElement>) => {    e.preventDefault();    this.props.form.validateFields((err: any, values: SearchFilterValue) => {      const { onSubmit } = this.props;      const formData = {};      for (let key in values) {        if (values[key] !== undefined) {          if (Array.isArray(values[key])) {            if (values[key].length > 0)              formData[key] = values[key].join(',');          } else {            formData[key] = values[key];          }        }      }      if (onSubmit) onSubmit(formData);    });  };  handleReset = () => {    this.props.form.resetFields();    const { onReset } = this.props;    if (onReset) onReset();  };  isDisabled = (name: string) => {    const { disableFields } = this.props;    return disableFields && disableFields.length>0 && disableFields.includes(name)  };  render() {    const {      form: {getFieldDecorator},      formInitialValue,      filterConfig,      okButtonStyle,      resetButtonStyle,      buttonLocation,    } = this.props;    return (      <>        <Card bordered={false} style={{ marginTop: 24 }}>          <Form className={filterForm} onSubmit={this.handleSearch} labelAlign={"right"} labelCol={{xxl: {span: 1}, xl: {span: 2}, lg: {span: 3}, sm: {span: 3}}} wrapperCol={{span: 20}} style={{textAlign: 'left', marginLeft: -10}}>            {              filterConfig && filterConfig.map(item => {                switch(item.type) {                  case 'Select':                    return <Form.Item label={item.label} key={item.name} className={filterFormItemWithNormal}>                      {getFieldDecorator(item.name, {                        initialValue: formInitialValue ? formInitialValue[item.name] : undefined                      })(                        <Select                          showSearch                          mode={item.mode}                          style={{ width: '100%' }}                          placeholder="请选择"                          disabled={ this.isDisabled(item.name) }                        >                          {item.options && item.options.length > 0 ? item.options.map((valueItem: ItemProps) =>                            (valueItem.label && <Option key={valueItem.id}>{valueItem.label}</Option>)                          ) : undefined}                        </Select>                      )}                    </Form.Item>                    break;                  case 'Text':                    return <Form.Item label={item.label} key={item.name} className={filterFormItemWithNormal}>                      {getFieldDecorator(item.name, {                        initialValue: formInitialValue ? formInitialValue[item.name] : undefined                      })(                        <Input                          allowClear                          disabled={ this.isDisabled(item.name) }                        />                      )}                    </Form.Item>                    break;                  case 'Date':                    return <Form.Item label={item.label} key={item.name} className={filterFormItemWithNormal}>                      {getFieldDecorator(item.name, {                        initialValue: formInitialValue ? formInitialValue[item.name] : undefined                      })(                        <ChoiceDatePicker                          choiceList={['oneMonth', 'halfYear', 'oneYear']}                        />                      )}                    </Form.Item>                    break;                  default:                    // Button                    return <Form.Item label={item.label} key={item.name} className={filterFormItemWithNormal}>                      {getFieldDecorator(item.name, {                        initialValue: formInitialValue ? formInitialValue[item.name] : undefined                      })(                        <ButtonSelect                          formItem={item}                        />                      )}                    </Form.Item>                    break;                }              })            }            <Row>              <Col                span={24}                style={ buttonLocation && buttonLocation === 'right' ? {                  textAlign: 'right',                } : { textAlign: 'left', marginLeft: 10 }}              ><Button type="primary" htmlType="submit" style={okButtonStyle}>搜索</Button>                <Button                  style={Object.assign({                    marginLeft: 8,                  }, resetButtonStyle)}                  onClick={this.handleReset}                >清除</Button></Col>            </Row>          </Form>        </Card>      </>    );  }}let timeout: any;const onValuesChange = (props: SearchFilterProps, changedValues: any, allValues: any) => {  const formData = {};  for (let key in allValues) {    if (allValues[key] !== undefined) {      formData[key] = allValues[key];      if (Array.isArray(allValues[key])) {        if (allValues[key].length > 0)          formData[key] = allValues[key].join(',');      } else {        formData[key] = allValues[key];      }    }  }  if (props.onSubmit) {    if (timeout) {      clearTimeout(timeout);      timeout = null;    }    var debounceChange = function() {      if (props.onSubmit)        props.onSubmit(formData)    };    timeout = setTimeout(debounceChange, 500);  }};export default Form.create<SearchFilterProps>({ name: 'part_filter', onValuesChange: onValuesChange })(SearchFilter);</code></pre><p>ButtonSelect.tsx</p><pre class=" language-react"><code class="language-react">import React, { useState, useEffect } from 'react';import { Button } from 'antd';import {  filterFormItemButton, filterFormItemButtonSelected,} from './index.less';export interface ItemProps {  id: string | number;  label: string | number;}export interface FormItem {  label: string;  mode: string;  name: string;  type: string;  options: ItemProps[];}interface ButtonSelectProps {  value?: any[] | undefined;  onChange?: (values: any) => void;  formItem: FormItem;}// 多选按钮 单选按钮const ButtonSelect = (props: ButtonSelectProps) => {  const { formItem, onChange, value } = props;  const [selected, setSelected] = useState(value ? value : []);  useEffect(() => {    const val = props.value ? props.value : [];    setSelected(val)}, [props.value])  const triggerChange = (changedValue: any[]) => {    if (onChange) {      onChange(changedValue);    }  };  const handleChange = (item: FormItem, value: string | number) => {    let valueList: any[] = [value];    if (selected && selected.includes(value)) {      valueList = selected.filter(v => v !== value);    } else if (selected) {      if (item.mode === 'single') {        valueList = [value];      } else {        valueList = [...selected, value];      }    }    setSelected(valueList);    triggerChange(valueList);  };  return (    <>      {formItem.options && formItem.options.map((valueItem: ItemProps) =>        <Button          key={valueItem.id}          size='small'          type={selected && selected.includes(valueItem.id) ? undefined : 'link'}          className={selected && selected.includes(valueItem.id) ? filterFormItemButtonSelected : filterFormItemButton}          onClick={()=>{handleChange(formItem, valueItem.id)}}        >          {valueItem.label}        </Button>      )}    </>  );};export default ButtonSelect;</code></pre><h3 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h3><p>​    因为是实时搜索，特别是文本类型的搜索，每次输入，都会触发请求，为了节省资源，添加了防抖操作。​    </p><h3 id="不足之处"><a href="#不足之处" class="headerlink" title="不足之处"></a>不足之处</h3><p>​    当搜索项为下拉列表时，如果选项过多，会造成页面卡顿问题，正在解决中…..</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
